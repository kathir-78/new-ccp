<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Amazon Connect CCP</title>
  <style>
    html, body, #ccp {
      margin: 0;
      height: 100%;
      width: 100%;
    }
  </style>
</head>
<body>

<div id="ccp"></div>

<script src="https://unpkg.com/amazon-connect-streams@1.7.8/release/connect-streams-min.js"></script>

<script>
  const CCP_URL = "https://p3-sample.my.connect.aws/ccp-v2/";
  const REGION = "us-east-1";

  connect.core.initCCP(document.getElementById("ccp"), {
    ccpUrl: CCP_URL,
    region: REGION,
    loginPopup: true,
    loginPopupAutoClose: true,
    softphone: { allowFramedSoftphone: true }
  });

  // Agent can set Available / Offline normally
  connect.agent(agent => {
    console.log("Agent logged in:", agent.getName());
  });

  // ðŸ”‘ THIS IS THE IMPORTANT PART
  connect.contact(contact => {
    const contactId = contact.getContactId();

    contact.onIncoming(() => {
      const phone =
        contact.getActiveInitialConnection()
          ?.getEndpoint()?.phoneNumber || "";

      window.opener?.postMessage({
        type: "CALL_EVENT",
        phone,
        contactId
      }, "*");
    });
  });
</script>

</body>
</html>
