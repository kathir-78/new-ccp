<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Amazon Connect CCP</title>
</head>
<body>

  <!-- Native CCP UI -->
  <div id="ccp" style="height:100vh;"></div>

  <script src="https://unpkg.com/amazon-connect-streams@1.7.8/release/connect-streams-min.js"></script>

  <script>
    const CCP_URL = "https://p3-sample.my.connect.aws/ccp-v2/";
    const REGION = "us-east-1";

    connect.core.initCCP(document.getElementById("ccp"), {
      ccpUrl: CCP_URL,
      region: REGION,
      loginPopup: true,
      loginPopupAutoClose: true,
      softphone: { allowFramedSoftphone: true }
    });

    // Emit call events outward
    connect.contact(contact => {
      const contactId = contact.getContactId();

      contact.onIncoming(() => emit("RINGING", contact));
      contact.onConnected(() => emit("CONNECTED", contact));
      contact.onEnded(() => emit("ENDED", contact));
    });

    function emit(status, contact) {
      const phone =
        contact.getActiveInitialConnection()
          ?.getEndpoint()?.phoneNumber || "";

      window.opener?.postMessage({
        type: "CALL_EVENT",
        status,
        phone,
        contactId: contact.getContactId()
      }, "*");
    }
  </script>

</body>
</html>
